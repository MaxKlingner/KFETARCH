<!DOCTYPE html>
<html>
<head>
    <title>Commande Cafeteria</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
        body { font-family: Arial; max-width: 600px; margin: 0 auto; padding: 20px; background: #f5f5f5; }
        .container { background: white; padding: 30px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .produit { display: flex; justify-content: space-between; align-items: center; padding: 10px 0; border-bottom: 1px solid #eee; }
        .btn { background: #4CAF50; color: white; padding: 15px; border: none; border-radius: 8px; font-size: 18px; cursor: pointer; margin-top: 20px; width: 100%; }
        .btn-bancontact { background: #FF6B00; color: white; padding: 15px; border: none; border-radius: 8px; font-size: 18px; cursor: pointer; margin: 10px 0; width: 100%; }
        .total { font-size: 24px; font-weight: bold; text-align: center; margin: 20px 0; color: #2c5aa0; }
        input[type="number"] { width: 60px; padding: 8px; text-align: center; }
        input[type="text"] { width: 100%; padding: 10px; margin: 10px 0; }
        .info-box { background: #e8f5e8; padding: 20px; border-radius: 10px; margin: 20px 0; text-align: center; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üçï Commande Cafeteria</h1>
        
        <div>
            <label><strong>Nom et pr√©nom :</strong></label>
            <input type="text" id="nom" placeholder="Votre nom" required>
        </div>
        
        <h3>üçΩÔ∏è Manger</h3>
        <div class="produit">
            <span>Chips (1‚Ç¨)</span>
            <input type="number" id="chips" min="0" max="10" value="0" onchange="calculerTotal()">
        </div>
        <div class="produit">
            <span>Bueno (1‚Ç¨)</span>
            <input type="number" id="bueno" min="0" max="10" value="0" onchange="calculerTotal()">
        </div>
        <div class="produit">
            <span>Gaufre nature (2‚Ç¨)</span>
            <input type="number" id="gaufre_nature" min="0" max="10" value="0" onchange="calculerTotal()">
        </div>
        <div class="produit">
            <span>Gaufre choco (2.5‚Ç¨)</span>
            <input type="number" id="gaufre_choco" min="0" max="10" value="0" onchange="calculerTotal()">
        </div>
        
        <h3>ü•§ Boire</h3>
        <div class="produit">
            <span>Soda (1‚Ç¨)</span>
            <input type="number" id="soda" min="0" max="10" value="0" onchange="calculerTotal()">
        </div>
        
        <div class="total" id="total">Total : ‚Ç¨0.00</div>
        
        <button class="btn" onclick="afficherPaiement()">üí≥ Commander et payer</button>
    </div>

    <script>
        const prix = {
            chips: 1.00, bueno: 1.00, gaufre_nature: 2.00, gaufre_choco: 2.50, soda: 1.00
        };

        function calculerTotal() {
            let total = 0;
            Object.keys(prix).forEach(produit => {
                total += (parseInt(document.getElementById(produit).value) || 0) * prix[produit];
            });
            document.getElementById('total').textContent = 'Total : ‚Ç¨' + total.toFixed(2);
            return total;
        }

        function afficherPaiement() {
            var nom = document.getElementById('nom').value;
            var total = calculerTotal();
            
            if (!nom) return alert("Veuillez entrer votre nom");
            if (total === 0) return alert("Veuillez s√©lectionner au moins un produit");
            
            var votreIBAN = "BE71123456789012"; // ‚ö†Ô∏è REMPLACEZ PAR VOTRE IBAN
            var code = 'CAFE' + Math.floor(1000 + Math.random() * 9000);
            
            var resultat = `
                <h1>üéâ Commande confirm√©e !</h1>
                
                <div class="info-box">
                    <p><strong>${nom}</strong></p>
                    <p style="font-size: 32px; font-weight: bold; color: #2c5aa0;">‚Ç¨${total.toFixed(2)}</p>
                    <p>Code : <strong style="font-size: 20px;">${code}</strong></p>
                </div>
                
                <div style="text-align: center; margin: 30px 0;">
                    <h3>üì± TEST Bancontact :</h3>
                    
                    <button class="btn-bancontact" onclick="testBancontact(${total}, '${code}', '${votreIBAN}')">
                        üè¶ ESSAYER d'ouvrir Bancontact
                    </button>
                    
                    <div style="background: #e3f2fd; padding: 15px; border-radius: 8px; margin: 15px 0;">
                        <p><strong>Ce qui devrait se passer :</strong></p>
                        <p>üì± <strong>Android</strong> : Bancontact s'ouvre directement</p>
                        <p>üì± <strong>iPhone</strong> : "Ouvrir avec Bancontact?"</p>
                        <p>‚ùå <strong>√âchec</strong> : Message d'erreur</p>
                    </div>
                    
                    <div style="background: #fff3cd; padding: 20px; border-radius: 10px; margin: 20px 0;">
                        <p><strong>Informations manuelles (fallback) :</strong></p>
                        <p>Montant: <strong>‚Ç¨${total.toFixed(2)}</strong></p>
                        <p>Communication: <strong>${code}</strong></p>
                        <p>IBAN: <strong>${votreIBAN}</strong></p>
                    </div>
                </div>
                
                <div style="text-align: center;">
                    <button class="btn" onclick="window.location.reload()">üîÑ Nouvelle commande</button>
                </div>
            `;
            
            document.querySelector('.container').innerHTML = resultat;
        }

        function testBancontact(total, code, iban) {
            console.log("üöÄ TEST Bancontact d√©marr√©...");
            
            // FORMATS DE LIENS BANCONTACT √Ä TESTER
            var liens = [
                {
                    nom: "Format Bancontact officiel",
                    url: `bancontact://pay?amount=${Math.round(total * 100)}&reference=${code}&creditor=${iban}&creditorName=CAFETERIA`
                },
                {
                    nom: "Format BCE/KBC", 
                    url: `bce://payment?amount=${total}&message=${code}&receiver=${iban}`
                },
                {
                    nom: "Format URL Bancontact",
                    url: `https://bancontact.com/pay?amount=${total}&reference=${code}`
                },
                {
                    nom: "Format Intent Android",
                    url: `intent://pay?amount=${total}&reference=${code}#Intent;scheme=bancontact;package=com.bancontact.mobile;end;`
                }
            ];
            
            // Essayer chaque lien
            for (var i = 0; i < liens.length; i++) {
                console.log("Essai " + (i+1) + ": " + liens[i].nom);
                console.log("URL: " + liens[i].url);
                
                try {
                    // Cr√©er un lien invisible et cliquer dessus (plus fiable)
                    var link = document.createElement('a');
                    link.href = liens[i].url;
                    link.style.display = 'none';
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                    
                    console.log("‚úÖ Lien accept√© : " + liens[i].nom);
                    
                    // Attendre un peu pour voir si √ßa fonctionne
                    setTimeout(function() {
                        // Si on est toujours sur la page, essayer le lien suivant
                        if (i === liens.length - 1) {
                            alert("Bancontact n'a pas r√©pondu. Essayez manuellement.");
                        }
                    }, 1000);
                    
                    return; // Sortir apr√®s le premier essai
                    
                } catch (e) {
                    console.log("‚ùå √âchec : " + liens[i].nom);
                    // Continuer avec le lien suivant
                }
            }
            
            // Si aucun lien ne fonctionne
            alert("‚ùå Aucun format de lien n'a fonctionn√©. Ouvrez Bancontact manuellement.");
        }
    </script>
</body>
</html>
